
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/> 
<title>JUMPNetwork: The Pipeline</title> 
<link href="search/search.css" rel="stylesheet" type="text/css"/> 
<script type="text/javascript" src="search/search.js"></script> 
<link href="navtree.css" rel="stylesheet" type="text/css"/> 
<script type="text/javascript" src="jquery.js"></script> 
<script type="text/javascript" src="navtree.js"></script> 
<script type="text/javascript" src="resize.js"></script> 
<script type="text/javascript"> 
$(document).ready(initResizable);
</script> 
<link href="doxygen.css" rel="stylesheet" type="text/css"/> 
</head> 
<body onload='searchBox.OnSelectItem(0);'> 
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script> 
<div id="top"> 
<div id="titlearea"> 
<div class='main_header'><div class="logo_seqoy"></div></div>
</div> 

<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('a00001.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>The Pipeline </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p><a class="el" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> implements an advanced form of the <a href="http://java.sun.com/blueprints/corej2eepatterns/Patterns/InterceptingFilter.html">Intercepting Filter Pattern</a> to give a user full control over how an event is handled and how the <a class="el" href="a00033.html" title="Handles or intercepts a Event, and sends a Event to the next handler in a Pipeline.">JPPipelineHandler</a> in the pipeline interact with each other.</p>
<h2>How an event flows in a pipeline</h2>
<p>The following diagram describes how a <a class="el" href="a00026.html">Event</a> are processed by an <a class="el" href="a00033.html">Handler</a> in a <a class="el" href="a00022.html">Pipeline</a>. </p>
<p>A <a class="el" href="a00026.html">JPPipelineEvent</a> can be handled by either a <a class="el" href="a00039.html" title="Handles or intercepts an upstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler in...">JPPipelineUpstreamHandler</a> or a <a class="el" href="a00024.html" title="Handles or intercepts a downstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler i...">JPPipelineDownstreamHandler</a> and be forwarded to the closest handler by calling <a class="el" href="a00034.html#a9ab02ec0933865652634c54595ff7dd7" title="Sends the specified JPPipelineEvent to the JPPipelineUpstreamHandler which is placed in the closest u...">sendUpstream: (JPPipelineHandlerContext-p)</a> or <a class="el" href="a00034.html#a292ed51fe0b2e1ce6b2ed517be5fa5e8" title="Sends the specified JPPipelineEvent to the JPPipelineDownstreamHandler which is placed in the closest...">sendDownstream: (JPPipelineHandlerContext-p)</a>. The meaning of the event is interpreted somewhat differently depending on whether it is going upstream or going downstream. Please refer to <a class="el" href="a00026.html">JPPipelineEvent</a> for more information.</p>
<div align="center">
<img src="JUMPNetworkDiagrams.jpg" alt="JUMPNetworkDiagrams.jpg"/>
</div>
<p>An upstream event is handled by the upstream handlers in the bottom-up direction as shown on the left side of the diagram. An upstream handler usually handles the inbound data on the bottom of the diagram. The inbound data is often read from a remote peer via the actual input operation. If an upstream event goes beyond the top upstream handler, it is discarded silently. </p>
<p>A downstream event is handled by the downstream handler in the top-down direction as shown on the right side of the diagram. A downstream handler usually generates or transforms the outbound traffic such as write requests. If a downstream event goes beyond the bottom downstream handler, it is handled by an transporter object associated with the <a class="el" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a>. The transporter often performs the actual output operation. </p>
<p>For example, let us assume that we created the following pipeline: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> *p = [[<a class="code" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> init] retain];
 [p addLast:<span class="stringliteral">@&quot;1&quot;</span> withHandler:[UpstreamHandlerA init]];
 [p addLast:<span class="stringliteral">@&quot;2&quot;</span> withHandler:[UpstreamHandlerB init]];
 [p addLast:<span class="stringliteral">@&quot;3&quot;</span> withHandler:[DownstreamHandlerA init]];
 [p addLast:<span class="stringliteral">@&quot;4&quot;</span> withHandler:[DownstreamHandlerB init]];
 [p addLast:<span class="stringliteral">@&quot;5&quot;</span> withHandler:[UpstreamHandlerX init]];
</pre></div><p>In the example above, the class whose name starts with <b>Upstream</b> means it is an upstream handler. The class whose name starts with <b>Downstream</b> means it is a downstream handler. </p>
<p>In the given example configuration, the handler evaluation order is 1, 2, 3, 4, 5 when an event goes upstream. When an event goes downstream, the order is 5, 4, 3, 2, 1. On top of this principle, <a class="el" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> skips the evaluation of certain handlers to shorten the stack depth: </p>
<ul>
<li>
3 and 4 don't implement <a class="el" href="a00039.html" title="Handles or intercepts an upstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler in...">JPPipelineUpstreamHandler</a>, and therefore the actual evaluation order of an upstream event will be: 1, 2, and 5. </li>
<li>
1, 2, and 5 don't implement <a class="el" href="a00024.html" title="Handles or intercepts a downstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler i...">JPPipelineDownstreamHandler</a>, and therefore the actual evaluation order of a downstream event will be: 4 and 3. </li>
<li>
If 5 extended <a class="el" href="a00042.html" title="A JPPipelineHandler which provides an individual handler method for each event type.">JPSimplePipelineHandler</a> which implements both <a class="el" href="a00039.html" title="Handles or intercepts an upstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler in...">JPPipelineUpstreamHandler</a> and <a class="el" href="a00024.html" title="Handles or intercepts a downstream JPPipelineEvent, and sends a JPPipelineEvent to the next handler i...">JPPipelineDownstreamHandler</a>, the evaluation order of an upstream and a downstream event could be 1, 2, 5 and 5, 4, 3 respectively. </li>
</ul>
<h2>Building a pipeline</h2>
<p>A user is supposed to have one or more <a class="el" href="a00033.html" title="Handles or intercepts a Event, and sends a Event to the next handler in a Pipeline.">JPPipelineHandler</a> in a pipeline to receive I/O events (e.g. read) and to request I/O operations (e.g. write). For example, a typical application will have the following handlers in each channel's pipeline, but your mileage may vary depending on the complexity and characteristics of the protocol and business logic:</p>
<ol>
<li>
Protocol Decoder - translates binary data into a Objective-C object. </li>
<li>
Protocol Encoder - translates a Objective-C object into binary data. </li>
<li>
Business Logic Handler - performs the actual business logic (e.g. database access). </li>
</ol>
<p>and it could be represented as shown in the following example:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a>* pipeline = [[<a class="code" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> init] retain];
 [p addLast:<span class="stringliteral">@&quot;decoder&quot;</span> withHandler:[MyProtocolDecoder init]];
 [p addLast:<span class="stringliteral">@&quot;encoder&quot;</span> withHandler:[MyProtocolEncoder init]];
 [p addLast:<span class="stringliteral">@&quot;handler&quot;</span> withHandler:[MyBusinessLogicHandler init]];
</pre></div><h2>Thread safety</h2>
<p>A <a class="el" href="a00033.html" title="Handles or intercepts a Event, and sends a Event to the next handler in a Pipeline.">JPPipelineHandler</a> can be added or removed at any time because a <a class="el" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a> is thread safe. For example, you can insert a <b>SslHandler</b> when sensitive information is about to be exchanged, and remove it after the exchange.</p>
<h2>Pitfall</h2>
<p>Due to the internal implementation detail of the current default <a class="el" href="a00022.html" title="JPPipeline is implementation of an presentation-tier request handling mechanism to receive many diffe...">JPPipeline</a>, the following code does not work as expected if <code>FirstHandler</code> is the last handler in the pipeline:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">@interface </span>FirstHandler : <a class="code" href="a00043.html" title="A JPPipelineUpstreamHandler implementation which provides an individual handler method for each event...">JPSimplePipelineUpstreamHandler</a> {}
 <span class="keyword">@end</span>
 
 <span class="keyword">@implementation </span>FirstHandler
 
 -(void)messageReceived:(&lt;<a class="code" href="a00034.html" title="Enables a JPPipelineHandler to interact with its JPPipeline and other handlers.">JPPipelineHandlerContext</a>&gt;)ctx withMessageEvent:(&lt;<a class="code" href="a00035.html" title="A JPPipelineEvent which represents the transmission or reception of a message.">JPPipelineMessageEvent</a>&gt;)e {
         <span class="comment">// Remove this handler from the pipeline,</span>
         [[ctx <a class="code" href="a00034.html#a19bb45818df9ae3674732158f8d1cfd9" title="Returns the Pipeline that this context belongs to.">getPipeline</a>] <a class="code" href="a00022.html#ac3feebdba37c2134e856e7a5ab02e434" title="Removes the specified JPPipelineHandler from this pipeline.">removeByHandler</a>:self];
         <span class="comment">// And let SecondHandler handle the current event.</span>
         [[ctx <a class="code" href="a00034.html#a19bb45818df9ae3674732158f8d1cfd9" title="Returns the Pipeline that this context belongs to.">getPipeline</a>] <a class="code" href="a00022.html#a7a3cb65c4e376339b36fad298fb4674d" title="Appends a Handler at the last position of this pipeline.">addLast</a>:@&quot;2nd&quot; <a class="code" href="a00022.html#a7a3cb65c4e376339b36fad298fb4674d" title="Appends a Handler at the last position of this pipeline.">withHandler</a>:[SecondHandler init]];
         [ctx <a class="code" href="a00034.html#a9ab02ec0933865652634c54595ff7dd7" title="Sends the specified JPPipelineEvent to the JPPipelineUpstreamHandler which is placed in the closest u...">sendUpstream</a>:e];
 }
 <span class="keyword">@end</span>
</pre></div><p>To implement the expected behavior, you have to add <code>SecondHandler</code> before the removal or make sure there is at least one more handler between <code>FirstHandler</code> and <code>SecondHandler</code>. </p>
</div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="main.html">JUMP Network Programming Guide</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Properties</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath"> 
    <ul> 
      <li class="footer"><div class="copyright">
      		Copyright © 2011, <a href="http://seqoy.com">SEQOY.org</a> and <a href="http://pauloliveira.net/resume">Paulo Oliveira</a>. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License Version 2.0</a>. Documentation by <a href="http://www.doxygen.org">Doxygen</a>. 
      	</div>
      </li> 
    </ul> 
  </div>
